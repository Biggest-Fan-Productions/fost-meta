#!/bin/bash
svn up .

export LD_LIBRARY_PATH=../dist/lib
if test -z $1
then {
    export VARIANTS=debug
} else {
    export VARIANTS=$1
}
fi

if test ! -e ~/bin
then {
    mkdir ~/bin
}
fi

if test ! -e ../Boost/install
then {
    if ! test -e ../Boost
    then {
        svn co svn://svn.felspar.com/external/Boost ../Boost
    }
    fi
    cd ../Boost
    ./build
    cd ../fost
}
fi

if bjam -j`grep -c ^processor /proc/cpuinfo` --toolset=gcc $VARIANTS
then {
    if ../dist/bin/ftest -b false \
        libfost-core-test-smoke.so \
        libfost-crypto-test-smoke.so
    then {
        echo fost-core smoke tests passed
    } else {
        exit 1
    }
    fi
} else {
    exit 1
}
fi

valgrind --leak-check=full --show-reachable=yes \
    ../dist/bin/ftest -b false \
        libfost-core-test-smoke.so \
        libfost-crypto-test-smoke.so
